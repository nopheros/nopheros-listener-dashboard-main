<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Debug Console</title>
    <style>
        body { font-family: monospace; background: #1e1e1e; color: #d4d4d4; margin: 0; padding: 20px; }
        #console { border: 1px solid #fff; padding: 10px; height: 600px; overflow-y: auto; background: #252526; white-space: pre-wrap; word-break: break-all; }
        .log { color: #d4d4d4; }
        .warn { color: #ce9178; }
        .error { color: #f48771; }
    </style>
</head>
<body>
    <h1>Dashboard Debug Console</h1>
    <button onclick="loadDashboard()">Load Dashboard</button>
    <button onclick="document.getElementById('console').innerHTML = ''">Clear</button>
    <div id="console"></div>

    <script>
        // Capture all console methods
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        console.log = function(...args) {
            originalLog(...args);
            const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            consoleDiv.innerHTML += `<div class="log">[LOG] ${msg}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        console.warn = function(...args) {
            originalWarn(...args);
            const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            consoleDiv.innerHTML += `<div class="warn">[WARN] ${msg}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        console.error = function(...args) {
            originalError(...args);
            const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            consoleDiv.innerHTML += `<div class="error">[ERROR] ${msg}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        function loadDashboard() {
            console.log("Loading dashboard scripts...");
            
            // Load config
            const configScript = document.createElement('script');
            configScript.src = 'js/config.js';
            configScript.onload = () => {
                console.log("config.js loaded");
                console.log("CONFIG:", CONFIG);
                
                // Load icecast
                const icecastScript = document.createElement('script');
                icecastScript.src = 'js/icecast.js';
                icecastScript.onload = () => {
                    console.log("icecast.js loaded");
                    console.log("IcecastAPI:", IcecastAPI);
                    
                    // Test fetch
                    console.log("Testing IcecastAPI.getAllTowerStatus()...");
                    IcecastAPI.getAllTowerStatus().then(result => {
                        console.log("getAllTowerStatus result:", result);
                    }).catch(err => {
                        console.error("getAllTowerStatus error:", err);
                    });
                };
                document.head.appendChild(icecastScript);
            };
            document.head.appendChild(configScript);
        }

        console.log("Debug console ready");
    </script>
</body>
</html>
