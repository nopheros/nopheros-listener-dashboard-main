<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ELBC Statmographifier - Live Listener Dashboard</title>
    <meta name="description" content="Real-time listener statistics for the Everlook Broadcasting Co. towers">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <!-- ========== HEADER ========== -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="logo-link">
                <img src="img/elbc_logo.png" alt="ELBC Everlook Logo" class="header-logo">
                <div class="logo-text">
                    <span class="site-title">Dwarvish &amp; Gnomish Engineered Everlook Broadcasting Co. Statmographifier</span>
                    <a href="https://nopheros.com" class="by-nopheros" target="_blank" rel="noopener noreferrer">By Nopheros</a>
                </div>
            </a>
            <nav class="main-nav">
                <a href="index.html" class="nav-link active">Live Dashboard</a>
                <a href="annals.html" class="nav-link">Annals of the Signal</a>
            </nav>
            <div class="header-badges">
                <span class="badge badge-live">
                    <span class="live-dot"></span> Live
                </span>
                <span class="badge" id="last-updated">--</span>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="content-wrapper-single">
            <!-- ========== MAIN CONTENT AREA ========== -->
            <div class="main-area">
                <!-- ========== EMBEDDED PLAYER (TOP) ========== -->
                <section class="player-section hero-player">
                    <div class="player-card primary-player">
                        <div class="player-header">
                            <div class="player-brand">
                                <img src="img/elbc_logo.png" alt="ELBC Everlook Logo" class="player-logo">
                                <div class="player-brand-text">
                                    <p class="eyebrow">Everlook Broadcasting Co.</p>
                                    <h2>Statmographifier Live Player</h2>
                                </div>
                            </div>
                            <div class="player-actions">
                                <button class="reload-btn" id="player-reload" title="Re-sync to live stream">
                                    <span class="reload-icon">ðŸ”„</span>
                                    <span class="reload-text">Re-sync</span>
                                </button>
                                <button class="popup-btn" id="player-popup-window" title="Open player in new window">
                                    â†— New Window
                                </button>
                                <button class="popup-btn" id="player-popup-modal" title="Open pop-out overlay player">
                                    â¤¢ Pop-out
                                </button>
                            </div>
                        </div>
                        <div class="player-controls">
                            <div class="player-control-row">
                                <label for="player-stream-select">Choose Tower</label>
                                <select id="player-stream-select">
                                    <option value="tower1">Tower 1 â€” Primary Broadcast</option>
                                    <option value="tower2">Tower 2 â€” Secondary Relay</option>
                                    <option value="tower3">Tower 3 â€” Atlantean Testing</option>
                                </select>
                            </div>
                            <audio id="tower1-player" controls preload="none">
                                <source src="" type="audio/mpeg" id="tower1-source">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                        <p class="now-playing" id="player-now-playing">Loading track...</p>
                    </div>
                </section>

                <!-- ========== TOWER CARDS ========== -->
                <section class="tower-cards-section">
                    <div class="section-header">
                        <h2>Tower Status</h2>
                        <div class="total-listeners-badge">
                            <span class="label">Total Overall Listeners:</span>
                            <span class="value" id="total-listeners">--</span>
                        </div>
                    </div>

                    <div class="tower-cards-grid">
                        <!-- Tower 1 Card -->
                        <div class="tower-card" data-tower="tower1">
                            <div class="tower-card-header">
                                <div class="tower-indicator" style="background-color: #3498db;"></div>
                                <h3>Tower 1</h3>
                                <span class="tower-subtitle">Primary Broadcast Tower</span>
                            </div>
                            <div class="tower-stats">
                                <div class="stat">
                                    <span class="stat-label">Current Listeners</span>
                                    <span class="stat-value" id="tower1-listeners">--</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Peak Listeners</span>
                                    <span class="stat-value" id="tower1-peak">--</span>
                                </div>
                            </div>
                            <div class="tower-now-playing">
                                <span class="np-label">Now Playing:</span>
                                <span class="np-value" id="tower1-np">--</span>
                            </div>
                        </div>

                        <!-- Tower 2 Card -->
                        <div class="tower-card" data-tower="tower2">
                            <div class="tower-card-header">
                                <div class="tower-indicator" style="background-color: #9b59b6;"></div>
                                <h3>Tower 2</h3>
                                <span class="tower-subtitle">Secondary Relay Tower</span>
                            </div>
                            <div class="tower-stats">
                                <div class="stat">
                                    <span class="stat-label">Current Listeners</span>
                                    <span class="stat-value" id="tower2-listeners">--</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Peak Listeners</span>
                                    <span class="stat-value" id="tower2-peak">--</span>
                                </div>
                            </div>
                            <div class="tower-now-playing">
                                <span class="np-label">Now Playing:</span>
                                <span class="np-value" id="tower2-np">--</span>
                            </div>
                        </div>

                        <!-- Tower 3 Card (NOW WITH LIVE DATA) -->
                        <div class="tower-card" data-tower="tower3">
                            <div class="tower-card-header">
                                <div class="tower-indicator" style="background-color: #27ae60;"></div>
                                <h3>Tower 3</h3>
                                <span class="tower-subtitle">Atlantean Testing Relay</span>
                            </div>
                            <div class="tower-stats">
                                <div class="stat">
                                    <span class="stat-label">Current Listeners</span>
                                    <span class="stat-value" id="tower3-listeners">--</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Peak Listeners</span>
                                    <span class="stat-value" id="tower3-peak">--</span>
                                </div>
                            </div>
                            <div class="tower-now-playing">
                                <span class="np-label">Now Playing:</span>
                                <span class="np-value" id="tower3-np">--</span>
                            </div>
                            <button class="tower3-play-link" id="tower3-play-btn" title="Play Tower 3 Stream">
                                <span class="play-icon">â–¶</span>
                                <span>Listen Now</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- ========== WEEKLY SCHEDULE ========== -->
                <section class="schedule-section-full">
                    <div class="schedule-panel">
                        <div class="panel-header">
                            <h2>Weekly Schedule</h2>
                            <span class="schedule-subtitle">EST & UTC</span>
                        </div>
                        <div class="schedule-table-wrapper-full">
                            <table class="schedule-table">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Show</th>
                                        <th>DJ</th>
                                        <th>EST</th>
                                        <th>ST</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Monday</td>
                                        <td>Treehab</td>
                                        <td>Nopheros</td>
                                        <td>11:00 AM</td>
                                        <td>4:00 PM</td>
                                    </tr>
                                    <tr>
                                        <td>Monday</td>
                                        <td>Living in the Past</td>
                                        <td>Leto</td>
                                        <td>6:00 PM</td>
                                        <td>11:00 PM</td>
                                    </tr>
                                    <tr>
                                        <td>Tuesday</td>
                                        <td>Groovin' Graveyard</td>
                                        <td>Crustman</td>
                                        <td>3:00 PM</td>
                                        <td>8:00 PM</td>
                                    </tr>
                                    <tr>
                                        <td>Tuesday</td>
                                        <td>The Whiski Lounge</td>
                                        <td>Whiski</td>
                                        <td>9:00 PM</td>
                                        <td>2:00 AM</td>
                                    </tr>
                                    <tr>
                                        <td>Wednesday</td>
                                        <td>Deeprun Classix</td>
                                        <td>Kando</td>
                                        <td>4:00 PM</td>
                                        <td>9:00 PM</td>
                                    </tr>
                                    <tr>
                                        <td>Friday</td>
                                        <td>Pilgrim of Signal</td>
                                        <td>Nopheros</td>
                                        <td>12:00 PM</td>
                                        <td>5:00 PM</td>
                                    </tr>
                                    <tr>
                                        <td>Saturday</td>
                                        <td>Tavern Talks</td>
                                        <td>Sheal</td>
                                        <td>3:00 PM</td>
                                        <td>8:00 PM</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="schedule-notes">
                            <strong>Live panel refreshes every 60 seconds</strong> | Pi scraper every 5 minutes<br>
                            Powered by Icecast
                        </p>
                    </div>
                </section>

                <!-- ========== LIVE CHART ========== -->
                <section class="chart-section">
                    <div class="chart-panel">
                        <div class="panel-header">
                            <h2>Listener Activity</h2>
                            <div class="chart-controls">
                                <button class="range-btn" data-range="2h">2 Hours</button>
                                <button class="range-btn active" data-range="24h">24 Hours</button>
                                <button class="range-btn" data-range="3d">3 Days</button>
                                <button class="range-btn" data-range="week">Week</button>
                                <button class="btn-icon" id="refresh-chart" title="Refresh now">
                                    ðŸ”„
                                </button>
                            </div>
                        </div>
                        <p class="chart-note">Tower 1 + Tower 2 only. Total listeners shown as bold line. Click legend to toggle.</p>
                        <div class="chart-wrapper">
                            <canvas id="listeners-chart"></canvas>
                        </div>
                        <div class="chart-footer">
                            <button class="btn-secondary" id="export-csv">Export CSV</button>
                            <button class="btn-secondary" id="download-json">Download JSON</button>
                        </div>
                    </div>
                </section>
            </div>
        </div>

    <!-- ========== FOOTER ========== -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-brand">
                <img src="img/elbc_logo.png" alt="ELBC Everlook Logo" class="footer-logo">
                <span>Everlook Broadcasting Co. Statmographifier</span>
            </div>
            <nav class="footer-nav">
                <a href="index.html">Live Dashboard</a>
                <a href="annals.html">Annals of the Signal</a>
            </nav>
            <div class="footer-info">
                <p>Live panel refreshes every 60 seconds; Pi scraper every 5 minutes</p>
                <p class="footer-credit">Powered by Icecast</p>
            </div>
        </div>
    </footer>

    <!-- ========== SCRIPTS ========== -->
    <script src="js/config.js"></script>
    <script src="js/icecast.js"></script>
    <script src="js/live-dashboard.js"></script>
</body>
</html>
